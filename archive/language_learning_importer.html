<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Language Learning Template Importer</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.5;
      color: #333;
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
    }
    h1 {
      color: #2563eb;
      margin-bottom: 1rem;
    }
    h2 {
      color: #4b5563;
      margin-top: 2rem;
      margin-bottom: 1rem;
    }
    p {
      margin-bottom: 1rem;
    }
    pre {
      background-color: #f1f5f9;
      padding: 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      margin-bottom: 1rem;
    }
    code {
      font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
    }
    ul {
      margin-bottom: 1rem;
    }
    li {
      margin-bottom: 0.5rem;
    }
    .button {
      display: inline-block;
      background-color: #2563eb;
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      text-decoration: none;
      font-weight: 600;
      margin-top: 1rem;
    }
    .button:hover {
      background-color: #1d4ed8;
    }
    .note {
      background-color: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    #importedData {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Language Learning Template Importer</h1>
  
  <p>This page helps you import the Language Learning template into The Context App.</p>
  
  <div class="note">
    <strong>Important:</strong> Make sure you are logged into The Context App before proceeding with the import.
  </div>
  
  <h2>How to Import</h2>
  
  <ol>
    <li>Click the "Download Import File" button below to download the template file</li>
    <li>Open The Context App and go to the main dashboard</li>
    <li>Click on the settings icon in the top right corner</li>
    <li>Select "Import/Export" from the menu</li>
    <li>Go to the "Import" tab</li>
    <li>Select "Import as new workspace(s)"</li>
    <li>Upload the downloaded file</li>
    <li>Click "Import Data"</li>
    <li>After successful import, refresh the page</li>
  </ol>
  
  <p>The Language Learning app contains:</p>
  
  <ul>
    <li>A complete Spanish beginner course</li>
    <li>Multiple choice and translation exercises</li>
    <li>Progress tracking system</li>
    <li>Custom UI components for interactive learning</li>
  </ul>
  
  <a href="language_learning_complete_import.json" download class="button">
    Download Import File
  </a>
  
  <h2>After Importing</h2>
  
  <p>After successful import:</p>
  
  <ol>
    <li>You'll see a new workspace called "Language Learning App"</li>
    <li>Select it to view the "Beginner Spanish Course" scenario</li>
    <li>Click "Start Flow" to begin the language learning experience</li>
    <li>Follow the prompts to complete exercises and track your progress</li>
  </ol>

  <h2>Troubleshooting</h2>

  <p>If you encounter any issues:</p>

  <ul>
    <li>Make sure you refresh the page after importing</li>
    <li>Check the browser console for any error messages</li>
    <li>Try clearing your browser cache and try again</li>
    <li>Ensure you have the latest version of The Context App</li>
  </ul>

  <!-- Hidden element to store import data -->
  <div id="importedData" 
    data-components='[
      {"name":"LessonIntroPlugin","code":"import React, { useEffect } from \"react\";\nimport { PluginComponentWithSchema, PluginComponentProps } from \"@/modules/plugins/types\";\nimport { Button } from \"@/components/ui/button\";\nimport { IndexedDBService } from \"@/modules/indexedDB/service\";\n\ninterface LessonIntroData {\n  lessonId: string;\n  nextExerciseId: string;\n}\n\nconst LessonIntroPlugin: PluginComponentWithSchema<LessonIntroData> = ({ \n  data, \n  appContext \n}: PluginComponentProps<LessonIntroData>) => {\n  const lessonData = data as LessonIntroData;\n  \n  // Load lesson data from IndexedDB when component mounts\n  useEffect(() => {\n    const loadLesson = async () => {\n      try {\n        // Ensure collection exists\n        await IndexedDBService.ensureCollection(\"language_lessons\");\n        \n        // Get lesson data\n        const lesson = await IndexedDBService.getItem(\"language_lessons\", lessonData.lessonId);\n        console.log(\"Loaded lesson:\", lesson);\n        \n        // Update user progress\n        await IndexedDBService.ensureCollection(\"user_progress\");\n        let progress = await IndexedDBService.getItem(\"user_progress\", \"user_default\");\n        \n        if (!progress) {\n          progress = {\n            id: \"user_default\",\n            completedLessons: [],\n            completedExercises: [],\n            currentLessonId: lessonData.lessonId,\n            currentExerciseId: lessonData.nextExerciseId,\n            score: 0\n          };\n        } else {\n          progress.currentLessonId = lessonData.lessonId;\n          progress.currentExerciseId = lessonData.nextExerciseId;\n        }\n        \n        await IndexedDBService.saveItem(\"user_progress\", progress);\n      } catch (error) {\n        console.error(\"Error loading lesson:\", error);\n      }\n    };\n    \n    loadLesson();\n  }, [lessonData.lessonId, lessonData.nextExerciseId]);\n  \n  const handleContinue = () => {\n    if (appContext?.nextStep) {\n      appContext.nextStep();\n    }\n  };\n  \n  return (\n    <div className=\"my-8 space-y-6\">\n      <div className=\"p-6 bg-primary/10 rounded-lg border border-primary/20\">\n        <h3 className=\"text-xl font-semibold mb-2\">Ready to begin?</h3>\n        <p className=\"text-muted-foreground\">\n          You\"re about to start the lesson. Click the button below when you\"re ready to continue.\n        </p>\n      </div>\n      \n      <Button \n        onClick={handleContinue}\n        className=\"w-full py-6 text-lg\"\n      >\n        Start Lesson\n      </Button>\n    </div>\n  );\n};\n\nLessonIntroPlugin.pluginSettings = {\n  replaceUserInput: true,\n  hideNavigationButtons: true\n};\n\nexport default LessonIntroPlugin;"},
      {"name":"ExercisePlugin","code":"import React, { useState, useEffect } from \"react\";\nimport { PluginComponentWithSchema, PluginComponentProps } from \"@/modules/plugins/types\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { IndexedDBService } from \"@/modules/indexedDB/service\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { updateContextFromNodeInput } from \"@/modules/flow/contextHandler\";\n\ninterface MultipleChoiceExerciseData {\n  exerciseId: string;\n  exerciseType: \"multiple-choice\" | \"translation\";\n  question: string;\n  options?: string[];\n  correctAnswer: string;\n  nextExerciseId: string;\n}\n\nconst ExercisePlugin: PluginComponentWithSchema<MultipleChoiceExerciseData> = ({ \n  data, \n  appContext \n}: PluginComponentProps<MultipleChoiceExerciseData>) => {\n  const exerciseData = data as MultipleChoiceExerciseData;\n  \n  const [answer, setAnswer] = useState(\"\");\n  const [submitted, setSubmitted] = useState(false);\n  const [isCorrect, setIsCorrect] = useState(false);\n  const [exercise, setExercise] = useState<any>(null);\n  \n  // Load exercise data from IndexedDB when component mounts\n  useEffect(() => {\n    const loadExercise = async () => {\n      try {\n        // Ensure collection exists\n        await IndexedDBService.ensureCollection(\"language_exercises\");\n        \n        // Get exercise data\n        const exerciseData = await IndexedDBService.getItem(\"language_exercises\", exerciseData.exerciseId);\n        setExercise(exerciseData);\n        console.log(\"Loaded exercise:\", exerciseData);\n        \n        // Update user progress\n        await IndexedDBService.ensureCollection(\"user_progress\");\n        let progress = await IndexedDBService.getItem(\"user_progress\", \"user_default\");\n        \n        if (!progress) {\n          progress = {\n            id: \"user_default\",\n            completedLessons: [],\n            completedExercises: [],\n            currentLessonId: \"\",\n            currentExerciseId: exerciseData.exerciseId,\n            score: 0\n          };\n        } else {\n          progress.currentExerciseId = exerciseData.exerciseId;\n        }\n        \n        await IndexedDBService.saveItem(\"user_progress\", progress);\n      } catch (error) {\n        console.error(\"Error loading exercise:\", error);\n      }\n    };\n    \n    loadExercise();\n  }, [exerciseData.exerciseId]);\n  \n  const handleOptionSelect = (option: string) => {\n    setAnswer(option);\n  };\n  \n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setAnswer(e.target.value);\n  };\n  \n  const handleSubmit = async () => {\n    // Check if answer is correct\n    const correct = answer.toLowerCase() === exerciseData.correctAnswer.toLowerCase();\n    setIsCorrect(correct);\n    setSubmitted(true);\n    \n    try {\n      // Update context with user\"s answer\n      if (appContext?.currentNode?.id && appContext.updateNodeUserPrompt) {\n        const contextValue = answer;\n        appContext.updateNodeUserPrompt(appContext.currentNode.id, contextValue);\n        \n        // Update context\n        if (appContext.currentNode.contextKey) {\n          updateContextFromNodeInput(appContext.currentNode.id);\n        }\n      }\n      \n      // Update user progress\n      await IndexedDBService.ensureCollection(\"user_progress\");\n      let progress = await IndexedDBService.getItem(\"user_progress\", \"user_default\");\n      \n      if (progress) {\n        if (correct) {\n          progress.score += 10;\n          if (!progress.completedExercises.includes(exerciseData.exerciseId)) {\n            progress.completedExercises.push(exerciseData.exerciseId);\n          }\n        }\n        \n        await IndexedDBService.saveItem(\"user_progress\", progress);\n      }\n    } catch (error) {\n      console.error(\"Error updating progress:\", error);\n    }\n  };\n  \n  const handleContinue = () => {\n    if (appContext?.nextStep) {\n      appContext.nextStep();\n    }\n  };\n  \n  // Render multiple choice exercise\n  if (exerciseData.exerciseType === \"multiple-choice\") {\n    return (\n      <div className=\"my-8 space-y-6\">\n        <div className=\"p-6 bg-card rounded-lg border\">\n          <h3 className=\"text-xl font-semibold mb-4\">{exerciseData.question}</h3>\n          \n          <RadioGroup \n            value={answer} \n            onValueChange={handleOptionSelect}\n            className=\"space-y-3\"\n            disabled={submitted}\n          >\n            {exerciseData.options?.map((option, index) => (\n              <div key={index} className=\"flex items-center space-x-2\">\n                <RadioGroupItem id={`option-${index}`} value={option} />\n                <Label \n                  htmlFor={`option-${index}`}\n                  className={`text-base flex-1 p-3 rounded ${submitted && option === exerciseData.correctAnswer ? \"bg-green-100 dark:bg-green-900/30\" : \"\"}`}\n                >\n                  {option}\n                  {submitted && option === exerciseData.correctAnswer && (\n                    <Badge variant=\"success\" className=\"ml-2\">Correct</Badge>\n                  )}\n                </Label>\n              </div>\n            ))}\n          </RadioGroup>\n          \n          {submitted && (\n            <div className={`mt-4 p-4 rounded-md ${isCorrect ? \"bg-green-100 dark:bg-green-900/30\" : \"bg-red-100 dark:bg-red-900/30\"}`}>\n              <p className=\"font-medium\">\n                {isCorrect ? \"✓ Correct!\" : `✗ Incorrect. The correct answer is: ${exerciseData.correctAnswer}`}\n              </p>\n              {exercise?.explanation && (\n                <p className=\"mt-2 text-muted-foreground\">{exercise.explanation}</p>\n              )}\n            </div>\n          )}\n        </div>\n        \n        {submitted ? (\n          <Button \n            onClick={handleContinue}\n            className=\"w-full py-6\"\n          >\n            Continue to Next Exercise\n          </Button>\n        ) : (\n          <Button \n            onClick={handleSubmit}\n            disabled={!answer}\n            className=\"w-full py-6\"\n          >\n            Check Answer\n          </Button>\n        )}\n      </div>\n    );\n  }\n  \n  // Render translation exercise\n  return (\n    <div className=\"my-8 space-y-6\">\n      <div className=\"p-6 bg-card rounded-lg border\">\n        <h3 className=\"text-xl font-semibold mb-4\">{exerciseData.question}</h3>\n        \n        <div className=\"space-y-3\">\n          <Label htmlFor=\"translation-input\" className=\"text-base\">\n            Your translation:\n          </Label>\n          <Input\n            id=\"translation-input\"\n            value={answer}\n            onChange={handleInputChange}\n            placeholder=\"Type your answer here\"\n            className=\"w-full py-6 text-lg\"\n            disabled={submitted}\n          />\n        </div>\n        \n        {submitted && (\n          <div className={`mt-4 p-4 rounded-md ${isCorrect ? \"bg-green-100 dark:bg-green-900/30\" : \"bg-red-100 dark:bg-red-900/30\"}`}>\n            <p className=\"font-medium\">\n              {isCorrect ? \"✓ Correct!\" : `✗ Incorrect. The correct answer is: ${exerciseData.correctAnswer}`}\n            </p>\n            {exercise?.explanation && (\n              <p className=\"mt-2 text-muted-foreground\">{exercise.explanation}</p>\n            )}\n          </div>\n        )}\n      </div>\n      \n      {submitted ? (\n        <Button \n          onClick={handleContinue}\n          className=\"w-full py-6\"\n        >\n          Continue to Next Exercise\n        </Button>\n      ) : (\n        <Button \n          onClick={handleSubmit}\n          disabled={!answer}\n          className=\"w-full py-6\"\n        >\n          Check Answer\n        </Button>\n      )}\n    </div>\n  );\n};\n\nExercisePlugin.pluginSettings = {\n  replaceUserInput: true,\n  hideNavigationButtons: true\n};\n\nexport default ExercisePlugin;"},
      {"name":"LessonCompletePlugin","code":"import React, { useEffect, useState } from \"react\";\nimport { PluginComponentWithSchema, PluginComponentProps } from \"@/modules/plugins/types\";\nimport { Button } from \"@/components/ui/button\";\nimport { IndexedDBService } from \"@/modules/indexedDB/service\";\nimport { useAppStore } from \"@/modules/store\";\n\ninterface LessonCompleteData {\n  lessonId: string;\n  score: number;\n  nextLessonId: string;\n}\n\nconst LessonCompletePlugin: PluginComponentWithSchema<LessonCompleteData> = ({ \n  data, \n  appContext \n}: PluginComponentProps<LessonCompleteData>) => {\n  const lessonData = data as LessonCompleteData;\n  const [userScore, setUserScore] = useState(0);\n  const [lesson, setLesson] = useState<any>(null);\n  const [nextLesson, setNextLesson] = useState<any>(null);\n  \n  // Get stop flow session function from store\n  const stopFlowSession = useAppStore(state => state.stopFlowSession);\n  \n  // Load user progress and mark lesson as completed\n  useEffect(() => {\n    const updateProgress = async () => {\n      try {\n        // Get user progress\n        await IndexedDBService.ensureCollection(\"user_progress\");\n        let progress = await IndexedDBService.getItem(\"user_progress\", \"user_default\");\n        \n        if (progress) {\n          // Mark lesson as completed\n          if (!progress.completedLessons.includes(lessonData.lessonId)) {\n            progress.completedLessons.push(lessonData.lessonId);\n          }\n          \n          // Update next lesson\n          progress.currentLessonId = lessonData.nextLessonId;\n          \n          // Save progress\n          await IndexedDBService.saveItem(\"user_progress\", progress);\n          \n          // Set user score\n          setUserScore(progress.score);\n        }\n        \n        // Get lesson info\n        await IndexedDBService.ensureCollection(\"language_lessons\");\n        const currentLesson = await IndexedDBService.getItem(\"language_lessons\", lessonData.lessonId);\n        setLesson(currentLesson);\n        \n        // Get next lesson info\n        const next = await IndexedDBService.getItem(\"language_lessons\", lessonData.nextLessonId);\n        setNextLesson(next);\n      } catch (error) {\n        console.error(\"Error updating progress:\", error);\n      }\n    };\n    \n    updateProgress();\n  }, [lessonData.lessonId, lessonData.nextLessonId]);\n  \n  const handleFinish = () => {\n    // Close the flow session and save changes\n    if (stopFlowSession) {\n      stopFlowSession(true);\n    }\n    \n    if (appContext?.nextStep) {\n      appContext.nextStep();\n    }\n  };\n  \n  return (\n    <div className=\"my-8 space-y-6\">\n      <div className=\"p-6 bg-green-100 dark:bg-green-900/30 rounded-lg border border-green-200 dark:border-green-800\">\n        <h3 className=\"text-xl font-semibold mb-2\">Lesson Completed!</h3>\n        <p className=\"text-muted-foreground\">\n          Congratulations on completing {lesson?.title || \"this lesson\"}.\n        </p>\n        \n        <div className=\"mt-4 flex items-center justify-between py-2 px-4 bg-background rounded-md\">\n          <span className=\"font-medium\">Your Score</span>\n          <span className=\"text-xl font-bold\">{userScore} points</span>\n        </div>\n      </div>\n      \n      {nextLesson && (\n        <div className=\"p-6 bg-primary/10 rounded-lg border border-primary/20\">\n          <h3 className=\"text-lg font-semibold mb-2\">Up Next</h3>\n          <p className=\"font-medium\">{nextLesson.title}</p>\n          <p className=\"text-sm text-muted-foreground\">{nextLesson.description}</p>\n        </div>\n      )}\n      \n      <Button \n        onClick={handleFinish}\n        className=\"w-full py-6 text-lg\"\n      >\n        Finish Lesson\n      </Button>\n    </div>\n  );\n};\n\nLessonCompletePlugin.pluginSettings = {\n  replaceUserInput: true,\n  hideNavigationButtons: true\n};\n\nexport default LessonCompletePlugin;"} 
    ]'
    data-collections='[
      {
        "name": "language_lessons",
        "items": [
          {
            "id": "lesson1",
            "title": "Greetings and Basic Phrases",
            "description": "Learn how to greet people and use basic phrases in Spanish",
            "level": "beginner",
            "language": "spanish",
            "order": 1,
            "exercises": ["exercise1", "exercise2"],
            "completed": false
          },
          {
            "id": "lesson2",
            "title": "Numbers and Counting",
            "description": "Learn to count and use numbers in Spanish",
            "level": "beginner",
            "language": "spanish",
            "order": 2,
            "exercises": ["exercise3", "exercise4"],
            "completed": false
          }
        ]
      },
      {
        "name": "language_exercises",
        "items": [
          {
            "id": "exercise1",
            "lessonId": "lesson1",
            "type": "multiple-choice",
            "question": "How do you say \"Hello\" in Spanish?",
            "options": ["Hola", "Gracias", "Adiós", "Por favor"],
            "correctAnswer": "Hola",
            "explanation": "Hola is the Spanish word for Hello",
            "order": 1
          },
          {
            "id": "exercise2",
            "lessonId": "lesson1",
            "type": "translation",
            "question": "Translate \"Good morning\" to Spanish",
            "correctAnswer": "Buenos días",
            "explanation": "Buenos días is the Spanish phrase for Good morning",
            "order": 2
          },
          {
            "id": "exercise3",
            "lessonId": "lesson2",
            "type": "multiple-choice",
            "question": "What is \"five\" in Spanish?",
            "options": ["Uno", "Tres", "Cinco", "Siete"],
            "correctAnswer": "Cinco",
            "explanation": "Cinco is the Spanish word for five",
            "order": 1
          },
          {
            "id": "exercise4",
            "lessonId": "lesson2",
            "type": "translation",
            "question": "Translate \"I want two apples\" to Spanish",
            "correctAnswer": "Quiero dos manzanas",
            "explanation": "Quiero = I want, dos = two, manzanas = apples",
            "order": 2
          }
        ]
      },
      {
        "name": "user_progress",
        "items": [
          {
            "id": "user_default",
            "completedLessons": [],
            "completedExercises": [],
            "currentLessonId": "lesson1",
            "currentExerciseId": "exercise1",
            "score": 0
          }
        ]
      }
    ]'
  ></div>

  <script>
    // This script makes the components and collections data available to the import process
    // It'll run when the import file is processed during import
    document.addEventListener('DOMContentLoaded', function() {
      // Expose the PluginRegistry to the window object if it exists
      try {
        if (window.PluginRegistry) {
          console.log('PluginRegistry found in window object');
        } else if (window.React) {
          console.log('React found but PluginRegistry not available');
        } else {
          console.log('Neither React nor PluginRegistry available');
        }
      } catch (err) {
        console.error('Error checking for PluginRegistry:', err);
      }
    });
  </script>
</body>
</html>